#!/usr/bin/env python
from flask import Flask, render_template, session, redirect, url_for, flash
from flask.ext.script import Manager
from flask.ext.bootstrap import Bootstrap
from flask.ext.moment import Moment
from flask.ext.wtf import Form
from wtforms import StringField, SubmitField,SelectField
from wtforms.validators import Required
from dotamax3 import Nice_Best_Hero,hero_data_after
import json

app = Flask(__name__)
app.config['SECRET_KEY'] = 'hard to guess string'

manager = Manager(app)
bootstrap = Bootstrap(app)
moment = Moment(app)


class NameForm(Form):
	Teammate_1 = StringField('1')
	Teammate_2 = StringField('2')
	Teammate_3 = StringField('3')
	Teammate_4 = StringField('4')
	Opponent_1 = StringField('1')
	Opponent_2 = StringField('2')
	Opponent_3 = StringField('3')
	Opponent_4 = StringField('4')
	Opponent_5 = StringField('5')
	Select_Mode = SelectField('Mode', choices=[('com','Com'), ('team','Team'),('opps','Opps'),('only_hero','Only Hero')])
	submit = SubmitField('Submit')


@app.errorhandler(404)
def page_not_found(e):
	return render_template('404.html'), 404


@app.errorhandler(500)
def internal_server_error(e):
	return render_template('500.html'), 500


@app.route('/', methods=['GET', 'POST'])
def index():
	form = NameForm()

	if form.validate_on_submit():
		teammate_list = (form.Teammate_1.data,form.Teammate_2.data,form.Teammate_3.data,form.Teammate_4.data)
		print teammate_list
		opponent_list = (form.Opponent_1.data,form.Opponent_2.data,form.Opponent_3.data,
			form.Opponent_4.data,form.Opponent_5.data)
		print opponent_list
		nice_best_hero = Nice_Best_Hero(teammate_list,opponent_list)	
		#old_name = session.get('name')
		#if old_name is not None and old_name != form.name.data:
			#flash('Looks like you have changed your name!')
		#session['name'] = form.name.data
		#flash(nice_best_hero)
		print nice_best_hero
		session['hero_info'] = nice_best_hero
		session['T_List'] = teammate_list
		session['O_List'] = opponent_list
		return redirect(url_for('index'))
	return render_template('index.html', form=form, hero_best_list = session.get('hero_info'),
		Teammates_List = session.get('T_List'),Opponents_List = session.get('O_List'))


if __name__ == '__main__':
	manager.run()

